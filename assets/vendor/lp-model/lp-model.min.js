!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).LPModel={})}(this,(function(e){"use strict";const t={GLP_MIN:1,GLP_MAX:2,GLP_FR:1,GLP_LO:2,GLP_UP:3,GLP_DB:4,GLP_FX:5,GLP_MSG_OFF:0,GLP_MSG_ERR:1,GLP_MSG_ON:2,GLP_MSG_ALL:3,GLP_MSG_DBG:4,GLP_UNDEF:1,GLP_FEAS:2,GLP_INFEAS:3,GLP_NOFEAS:4,GLP_OPT:5,GLP_UNBND:6},r={1:"Undefined",2:"Feasible",3:"Infeasible",4:"No feasible solution",5:"Optimal",6:"Unbounded"};function n(e,t,r,i){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,n.prototype),s.expected=t,s.found=r,s.location=i,s.name="SyntaxError",s}function i(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function s(e,t){var r,i,s,o,a={},u=(t=void 0!==t?t:{}).grammarSource,l={LPFile:mt},c=mt,f="end",h="maximize",b="minimize",p="max",v="min",m=":",d="subject to",y="st",g="s.t.",w="<=",A=">=",E="=",L="=<",x="=>",I="<",C="bounds",P="free",j="-infinity",M="+infinity",G="-inf",$="+inf",_="binary",O="binaries",S="bin",N="generals",F="general",R="gen",V=".",B="e",T="\\",U="\n",Z=/^[+\-]/,z=/^[a-zA-Z!"#$%&'()*+,.\/;?@_`'{|}~]/,X=/^[a-zA-Z0-9!"#$%&'()*+,.\/;?@_`'{|}~]/,Y=/^[0-9]/,D=/^[ \t\n\r]/,q=/^[^\n]/,K=ct("End",!0),J=ct("Maximize",!0),H=ct("Minimize",!0),Q=ct("MAX",!0),W=ct("MIN",!0),k=ct(":",!1),ee=ct("Subject To",!0),te=ct("ST",!0),re=ct("S.T.",!0),ne=ct("<=",!1),ie=ct(">=",!1),se=ct("=",!1),oe=ct("=<",!1),ae=ct("=>",!1),ue=ct("<",!1),le=ct("Bounds",!0),ce=ct("free",!0),fe=ht("infinity number"),he=ct("-infinity",!0),be=ct("+infinity",!0),pe=ct("-inf",!0),ve=ct("+inf",!0),me=ct("Binary",!0),de=ct("Binaries",!0),ye=ct("Bin",!0),ge=ct("Generals",!0),we=ct("General",!0),Ae=ct("Gen",!0),Ee=ft(["+","-"],!1,!1),Le=ht("variable name"),xe=ft([["a","z"],["A","Z"],"!",'"',"#","$","%","&","'","(",")","*","+",",",".","/",";","?","@","_","`","'","{","|","}","~"],!1,!1),Ie=ft([["a","z"],["A","Z"],["0","9"],"!",'"',"#","$","%","&","'","(",")","*","+",",",".","/",";","?","@","_","`","'","{","|","}","~"],!1,!1),Ce=ht("signed number"),Pe=ht("number"),je=ft([["0","9"]],!1,!1),Me=ct(".",!1),Ge=ct("e",!0),$e=ht("whitespace or comment"),_e=ft([" ","\t","\n","\r"],!1,!1),Oe=ct("\\",!1),Se=ft(["\n"],!0,!1),Ne=ct("\n",!1),Fe=function(e,t,r,n,i){return{objective:e,constraints:t||[],bounds:r||[],general:n||[],binary:i||[]}},Re=function(e,t,r){return{type:e.toLowerCase().startsWith("max")?"max":"min",name:t?t[0]:null,expression:r}},Ve=function(e){return e},Be=function(e,t,r,n){return{name:e?e[0]:null,expression:t,sense:r,value:n}},Te=function(){return"<"===lt()?"<=":">"===lt()?">=":lt()},Ue=function(e){return e},Ze=function(e){return{variable:e,range:"free"}},ze=function(e,t,r){return{variable:t,lower:e,upper:r}},Xe=function(e,t){return{variable:e,upper:t}},Ye=function(e,t){return{variable:t,lower:e}},De=function(e){return e.startsWith("-")?"-infinity":"+infinity"},qe=function(e){return e.map((e=>e[0]))},Ke=function(e){return e.map((e=>e[0]))},Je=function(e,t){let r=[e];for(let e of t){let t=e[1],n=e[3];"-"===t&&(n.coefficient=-n.coefficient),r.push(n)}return r},He=function(e,t){return t.coefficient=("+"===e?1:-1)*Math.abs(t.coefficient),t},Qe=function(e,t){return{coefficient:e,variable:t}},We=function(e){return{coefficient:1,variable:e}},ke=function(e){return{coefficient:e,variable:null}},et=function(){return lt()},tt=function(){return parseFloat(lt())},rt=function(e){return parseFloat(lt())},nt=0|t.peg$currPos,it=nt,st=[{line:1,column:1}],ot=nt,at=t.peg$maxFailExpected||[],ut=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');c=l[t.startRule]}function lt(){return e.substring(it,nt)}function ct(e,t){return{type:"literal",text:e,ignoreCase:t}}function ft(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function ht(e){return{type:"other",description:e}}function bt(t){var r,n=st[t];if(n)return n;if(t>=st.length)r=st.length-1;else for(r=t;!st[--r];);for(n={line:(n=st[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return st[t]=n,n}function pt(e,t,r){var n=bt(e),i=bt(t),s={source:u,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:i.line,column:i.column}};return r&&u&&"function"==typeof u.offset&&(s.start=u.offset(s.start),s.end=u.offset(s.end)),s}function vt(e){nt<ot||(nt>ot&&(ot=nt,at=[]),at.push(e))}function mt(){var t,r,n,i,s,o,u;return t=nt,jt(),r=function(){var t,r,n,i,s;t=nt,(r=e.substr(nt,8)).toLowerCase()===h?nt+=8:(r=a,0===ut&&vt(J));r===a&&((r=e.substr(nt,8)).toLowerCase()===b?nt+=8:(r=a,0===ut&&vt(H)),r===a&&((r=e.substr(nt,3)).toLowerCase()===p?nt+=3:(r=a,0===ut&&vt(Q)),r===a&&((r=e.substr(nt,3)).toLowerCase()===v?nt+=3:(r=a,0===ut&&vt(W)))));r!==a?(jt(),n=nt,(i=It())!==a?(58===e.charCodeAt(nt)?(s=m,nt++):(s=a,0===ut&&vt(k)),s!==a?n=i=[i,s]:(nt=n,n=a)):(nt=n,n=a),n===a&&(n=null),i=jt(),(s=Et())!==a?(it=t,t=Re(r,n,s)):(nt=t,t=a)):(nt=t,t=a);return t}(),r!==a?(jt(),n=function(){var t,r,n,i;t=nt,(r=e.substr(nt,10)).toLowerCase()===d?nt+=10:(r=a,0===ut&&vt(ee));r===a&&((r=e.substr(nt,2)).toLowerCase()===y?nt+=2:(r=a,0===ut&&vt(te)),r===a&&((r=e.substr(nt,4)).toLowerCase()===g?nt+=4:(r=a,0===ut&&vt(re))));if(r!==a){if(jt(),n=[],(i=dt())!==a)for(;i!==a;)n.push(i),i=dt();else n=a;n!==a?(it=t,t=Ve(n)):(nt=t,t=a)}else nt=t,t=a;return t}(),n!==a?(jt(),i=function(){var t,r,n,i;t=nt,(r=e.substr(nt,6)).toLowerCase()===C?nt+=6:(r=a,0===ut&&vt(le));if(r!==a){if(jt(),n=[],(i=yt())!==a)for(;i!==a;)n.push(i),i=yt();else n=a;n!==a?(it=t,t=Ue(n)):(nt=t,t=a)}else nt=t,t=a;return t}(),i===a&&(i=null),jt(),s=function(){var e,t,r,n;if(e=nt,At()!==a){if(jt(),t=[],r=nt,(n=It())!==a?r=n=[n,jt()]:(nt=r,r=a),r!==a)for(;r!==a;)t.push(r),r=nt,(n=It())!==a?r=n=[n,jt()]:(nt=r,r=a);else t=a;t!==a?(it=e,e=qe(t)):(nt=e,e=a)}else nt=e,e=a;return e}(),s===a&&(s=null),jt(),o=function(){var e,t,r,n;if(e=nt,wt()!==a){if(jt(),t=[],r=nt,(n=It())!==a?r=n=[n,jt()]:(nt=r,r=a),r!==a)for(;r!==a;)t.push(r),r=nt,(n=It())!==a?r=n=[n,jt()]:(nt=r,r=a);else t=a;t!==a?(it=e,e=Ke(t)):(nt=e,e=a)}else nt=e,e=a;return e}(),o===a&&(o=null),jt(),(u=e.substr(nt,3)).toLowerCase()===f?nt+=3:(u=a,0===ut&&vt(K)),u!==a?(jt(),it=t,t=Fe(r,n,i,s,o)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a),t}function dt(){var t,r,n,i,s,o;return t=nt,r=nt,(n=It())!==a?(58===e.charCodeAt(nt)?(i=m,nt++):(i=a,0===ut&&vt(k)),i!==a?r=n=[n,i]:(nt=r,r=a)):(nt=r,r=a),r===a&&(r=null),n=jt(),(i=Et())!==a?(jt(),s=function(){var t,r;e.substr(nt,2)===w?(t=w,nt+=2):(t=a,0===ut&&vt(ne));t===a&&(e.substr(nt,2)===A?(t=A,nt+=2):(t=a,0===ut&&vt(ie)),t===a&&(61===e.charCodeAt(nt)?(t=E,nt++):(t=a,0===ut&&vt(se)),t===a&&(e.substr(nt,2)===L?(t=L,nt+=2):(t=a,0===ut&&vt(oe)),t===a&&(e.substr(nt,2)===x?(t=x,nt+=2):(t=a,0===ut&&vt(ae)),t===a&&(t=nt,60===e.charCodeAt(nt)?(r=I,nt++):(r=a,0===ut&&vt(ue)),r!==a&&(it=t,r=Te()),t=r)))));return t}(),s!==a?(jt(),(o=Ct())!==a?(jt(),it=t,t=Be(r,i,s,o)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a),t}function yt(){var t,r,n,i,s,o;return t=nt,(r=It())!==a?(jt(),(n=e.substr(nt,4)).toLowerCase()===P?nt+=4:(n=a,0===ut&&vt(ce)),n!==a?(jt(),it=t,t=Ze(r)):(nt=t,t=a)):(nt=t,t=a),t===a&&(t=nt,(r=gt())!==a?(jt(),e.substr(nt,2)===w?(n=w,nt+=2):(n=a,0===ut&&vt(ne)),n!==a?(jt(),(i=It())!==a?(jt(),e.substr(nt,2)===w?(s=w,nt+=2):(s=a,0===ut&&vt(ne)),s!==a?(jt(),(o=gt())!==a?(jt(),it=t,t=ze(r,i,o)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a),t===a&&(t=nt,(r=It())!==a?(jt(),e.substr(nt,2)===w?(n=w,nt+=2):(n=a,0===ut&&vt(ne)),n!==a?(jt(),(i=gt())!==a?(jt(),it=t,t=Xe(r,i)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a),t===a&&(t=nt,(r=gt())!==a?(jt(),e.substr(nt,2)===w?(n=w,nt+=2):(n=a,0===ut&&vt(ne)),n!==a?(jt(),(i=It())!==a?(jt(),it=t,t=Ye(r,i)):(nt=t,t=a)):(nt=t,t=a)):(nt=t,t=a)))),t}function gt(){var t,r;return ut++,t=nt,(r=e.substr(nt,9)).toLowerCase()===j?nt+=9:(r=a,0===ut&&vt(he)),r===a&&((r=e.substr(nt,9)).toLowerCase()===M?nt+=9:(r=a,0===ut&&vt(be)),r===a&&((r=e.substr(nt,4)).toLowerCase()===G?nt+=4:(r=a,0===ut&&vt(pe)),r===a&&((r=e.substr(nt,4)).toLowerCase()===$?nt+=4:(r=a,0===ut&&vt(ve))))),r!==a&&(it=t,r=De(r)),(t=r)===a&&(t=Ct()),ut--,t===a&&(r=a,0===ut&&vt(fe)),t}function wt(){var t;return(t=e.substr(nt,6)).toLowerCase()===_?nt+=6:(t=a,0===ut&&vt(me)),t===a&&((t=e.substr(nt,8)).toLowerCase()===O?nt+=8:(t=a,0===ut&&vt(de)),t===a&&((t=e.substr(nt,3)).toLowerCase()===S?nt+=3:(t=a,0===ut&&vt(ye)))),t}function At(){var t;return(t=e.substr(nt,8)).toLowerCase()===N?nt+=8:(t=a,0===ut&&vt(ge)),t===a&&((t=e.substr(nt,7)).toLowerCase()===F?nt+=7:(t=a,0===ut&&vt(we)),t===a&&((t=e.substr(nt,3)).toLowerCase()===R?nt+=3:(t=a,0===ut&&vt(Ae)))),t}function Et(){var t,r,n,i,s,o,u,l;if(t=nt,(r=Lt())===a&&(r=xt()),r!==a){for(n=[],i=nt,s=jt(),o=e.charAt(nt),Z.test(o)?nt++:(o=a,0===ut&&vt(Ee)),o!==a?(u=jt(),(l=Lt())===a&&(l=xt()),l!==a?i=s=[s,o,u,l]:(nt=i,i=a)):(nt=i,i=a);i!==a;)n.push(i),i=nt,s=jt(),o=e.charAt(nt),Z.test(o)?nt++:(o=a,0===ut&&vt(Ee)),o!==a?(u=jt(),(l=Lt())===a&&(l=xt()),l!==a?i=s=[s,o,u,l]:(nt=i,i=a)):(nt=i,i=a);it=t,t=Je(r,n)}else nt=t,t=a;return t}function Lt(){var t,r,n;return t=nt,r=e.charAt(nt),Z.test(r)?nt++:(r=a,0===ut&&vt(Ee)),r!==a?(jt(),(n=xt())!==a?(it=t,t=He(r,n)):(nt=t,t=a)):(nt=t,t=a),t}function xt(){var e,t,r;return e=nt,(t=Pt())!==a?(jt(),(r=It())!==a?(it=e,e=Qe(t,r)):(nt=e,e=a)):(nt=e,e=a),e===a&&(e=nt,(t=It())!==a&&(it=e,t=We(t)),(e=t)===a&&(e=nt,(t=Pt())!==a&&(it=e,t=ke(t)),e=t)),e}function It(){var t,r,n,i,s,o,u;if(ut++,t=nt,r=nt,ut++,n=wt(),ut--,n===a?r=void 0:(nt=r,r=a),r!==a)if(n=nt,ut++,i=At(),ut--,i===a?n=void 0:(nt=n,n=a),n!==a)if(i=nt,ut++,(s=e.substr(nt,3)).toLowerCase()===f?nt+=3:(s=a,0===ut&&vt(K)),ut--,s===a?i=void 0:(nt=i,i=a),i!==a)if(s=e.charAt(nt),z.test(s)?nt++:(s=a,0===ut&&vt(xe)),s!==a){for(o=[],u=e.charAt(nt),X.test(u)?nt++:(u=a,0===ut&&vt(Ie));u!==a;)o.push(u),u=e.charAt(nt),X.test(u)?nt++:(u=a,0===ut&&vt(Ie));it=t,t=et()}else nt=t,t=a;else nt=t,t=a;else nt=t,t=a;else nt=t,t=a;return ut--,t===a&&(r=a,0===ut&&vt(Le)),t}function Ct(){var t,r;return ut++,t=nt,r=e.charAt(nt),Z.test(r)?nt++:(r=a,0===ut&&vt(Ee)),r===a&&(r=null),Pt()!==a?(it=t,t=tt()):(nt=t,t=a),ut--,t===a&&(r=a,0===ut&&vt(Ce)),t}function Pt(){var t,r,n,i,s,o,u,l;if(ut++,t=nt,r=[],n=e.charAt(nt),Y.test(n)?nt++:(n=a,0===ut&&vt(je)),n!==a)for(;n!==a;)r.push(n),n=e.charAt(nt),Y.test(n)?nt++:(n=a,0===ut&&vt(je));else r=a;if(r!==a){if(n=nt,46===e.charCodeAt(nt)?(i=V,nt++):(i=a,0===ut&&vt(Me)),i!==a){if(s=[],o=e.charAt(nt),Y.test(o)?nt++:(o=a,0===ut&&vt(je)),o!==a)for(;o!==a;)s.push(o),o=e.charAt(nt),Y.test(o)?nt++:(o=a,0===ut&&vt(je));else s=a;s!==a?n=i=[i,s]:(nt=n,n=a)}else nt=n,n=a;if(n===a&&(n=null),i=nt,(s=e.charAt(nt)).toLowerCase()===B?nt++:(s=a,0===ut&&vt(Ge)),s!==a){if(o=e.charAt(nt),Z.test(o)?nt++:(o=a,0===ut&&vt(Ee)),o===a&&(o=null),u=[],l=e.charAt(nt),Y.test(l)?nt++:(l=a,0===ut&&vt(je)),l!==a)for(;l!==a;)u.push(l),l=e.charAt(nt),Y.test(l)?nt++:(l=a,0===ut&&vt(je));else u=a;u!==a?i=s=[s,o,u]:(nt=i,i=a)}else nt=i,i=a;i===a&&(i=null),it=t,t=rt()}else nt=t,t=a;return ut--,t===a&&(r=a,0===ut&&vt(Pe)),t}function jt(){var t,r,n,i,s,o,u,l,c;for(ut++,nt,r=[],n=e.charAt(nt),D.test(n)?nt++:(n=a,0===ut&&vt(_e));n!==a;)r.push(n),n=e.charAt(nt),D.test(n)?nt++:(n=a,0===ut&&vt(_e));if(n=[],i=nt,92===e.charCodeAt(nt)?(s=T,nt++):(s=a,0===ut&&vt(Oe)),s!==a){for(o=[],u=e.charAt(nt),q.test(u)?nt++:(u=a,0===ut&&vt(Se));u!==a;)o.push(u),u=e.charAt(nt),q.test(u)?nt++:(u=a,0===ut&&vt(Se));if(10===e.charCodeAt(nt)?(u=U,nt++):(u=a,0===ut&&vt(Ne)),u!==a){for(l=[],c=e.charAt(nt),D.test(c)?nt++:(c=a,0===ut&&vt(_e));c!==a;)l.push(c),c=e.charAt(nt),D.test(c)?nt++:(c=a,0===ut&&vt(_e));i=s=[s,o,u,l]}else nt=i,i=a}else nt=i,i=a;for(;i!==a;)if(n.push(i),i=nt,92===e.charCodeAt(nt)?(s=T,nt++):(s=a,0===ut&&vt(Oe)),s!==a){for(o=[],u=e.charAt(nt),q.test(u)?nt++:(u=a,0===ut&&vt(Se));u!==a;)o.push(u),u=e.charAt(nt),q.test(u)?nt++:(u=a,0===ut&&vt(Se));if(10===e.charCodeAt(nt)?(u=U,nt++):(u=a,0===ut&&vt(Ne)),u!==a){for(l=[],c=e.charAt(nt),D.test(c)?nt++:(c=a,0===ut&&vt(_e));c!==a;)l.push(c),c=e.charAt(nt),D.test(c)?nt++:(c=a,0===ut&&vt(_e));i=s=[s,o,u,l]}else nt=i,i=a}else nt=i,i=a;return t=r=[r,n],ut--,r=a,0===ut&&vt($e),t}if(r=c(),t.peg$library)return{peg$result:r,peg$currPos:nt,peg$FAILED:a,peg$maxFailExpected:at,peg$maxFailPos:ot};if(r!==a&&nt===e.length)return r;throw r!==a&&nt<e.length&&vt({type:"end"}),i=at,s=ot<e.length?e.charAt(ot):null,o=ot<e.length?pt(ot,ot+1):pt(ot,ot),new n(n.buildMessage(i,s),i,s,o)}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,a=this.location.source+":"+o.line+":"+o.column;if(n){var u=this.location.end,l=i("",o.line.toString().length," "),c=n[s.line-1],f=(s.line===u.line?u.column:c.length+1)-s.column||1;t+="\n --\x3e "+a+"\n"+l+" |\n"+o.line+" | "+c+"\n"+l+" | "+i("",s.column-1," ")+i("",f,"^")}else t+="\n at "+a}return t},n.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."};class o{constructor({lb:e=0,ub:t="+infinity",vtype:r="CONTINUOUS",name:n=null}){if(!["CONTINUOUS","BINARY","INTEGER"].includes(r.toUpperCase()))throw new Error(`Invalid variable type: ${r}. Must be one of "CONTINUOUS", "BINARY", or "INTEGER".`);if("number"!=typeof e&&"-infinity"!==e)throw new Error(`Invalid lower bound: ${e}. Must be a number or "-infinity".`);if("number"!=typeof t&&"+infinity"!==t)throw new Error(`Invalid upper bound: ${t}. Must be a number or "+infinity".`);if("number"==typeof e&&"number"==typeof t&&e>t)throw new Error("Variable lower bound must be less than or equal to upper bound.");this.lb=e,this.ub="BINARY"===r?1:t,this.vtype=r.toUpperCase(),this.name=n}}class a{constructor(e,t,r){this.lhs=e,this.comparison=t,this.rhs=r}}e.Constr=a,e.Model=class{constructor(){this.variables=new Map,this.constraints=[],this.objective={expression:[0],sense:"MAXIMIZE"},this.varCount=0,this.solution=null,this.status=null,this.ObjVal=null}clear(){this.variables=new Map,this.constraints=[],this.objective={expression:[0],sense:"MAXIMIZE"},this.varCount=0,this.solution=null,this.status=null,this.ObjVal=null}addVar({lb:e,ub:t,vtype:r,name:n}={}){if(null==n)for(n="Var"+this.varCount++;this.variables.has(n);)n="Var"+this.varCount++;else if(this.variables.has(n))throw new Error(`Variable name '${n}' has already been used.`);const i=new o({lb:e,ub:t,vtype:r,name:n});return this.variables.set(n,i),i}addVars(e,{lb:t,ub:r,vtype:n}={}){const i={};return e.forEach((e=>{if("string"!=typeof e)throw new Error(`Variable name must be a string, got '${typeof e}' for '${e}'.`);if(this.variables.has(e))throw new Error(`Variable name '${e}' has already been used.`);const s=new o({lb:t,ub:r,vtype:n,name:e});this.variables.set(e,s),i[e]=s})),i}setObjective(e,t){if(!["MAXIMIZE","MINIMIZE"].includes(t.toUpperCase()))throw new Error(`Invalid sense: ${t}. Must be one of "MAXIMIZE" or "MINIMIZE".`);this.objective={expression:this.parseExpression(e),sense:t}}addConstr(e,t,r){if(e=this.parseExpression(e),r="number"==typeof r?[r]:this.parseExpression(r),"=="===t&&(t="="),!["<=","=",">="].includes(t))throw new Error(`Invalid comparison operator: ${t}. Must be one of "<=", "=", or ">=".`);const n=e.concat(r.map((e=>{if(Array.isArray(e)){if(2===e.length)return[-e[0],e[1]];if(3===e.length)return[-e[0],e[1],e[2]]}return-e}))),i=this.parseExpression(n),s=-i[0];i[0]=0;const o=new a(i,t,s);return this.constraints.push(o),o}parseExpression(e){let t={constant:0};for(let r of e)if(Array.isArray(r))if(2===r.length){const[e,n]=r;if(!(n instanceof o)||"number"!=typeof e)throw new Error(`Invalid term: ${r}. Must be [coefficient, variable].`);t[n.name]?t[n.name][0]+=e:t[n.name]=[e,n]}else{if(3!==r.length)throw new Error(`Invalid expression item: ${r}. Must be [coefficient, variable] or [coefficient, variable1, variable2].`);{const[e,n,i]=r;if(!(n instanceof o&&i instanceof o&&"number"==typeof e))throw new Error(`Invalid quadratic term: ${r}. Must be [coefficient, variable1, variable2].`);let s=n.name,a=i.name;s>a&&([s,a]=[a,s]);const u=`${s}_***_${a}`;t[u]?t[u][0]+=e:t[u]=[e,this.variables.get(s),this.variables.get(a)]}}else if(r instanceof o){const e=r.name;t[e]?t[e][0]+=1:t[e]=[1,r]}else{if("number"!=typeof r)throw new Error("Invalid expression item.");t.constant+=r}let r=[t.constant];delete t.constant;for(let e in t)0!==t[e][0]&&r.push(t[e]);return r}toLPFormat(){return function(e){let t="";function r(e){return e.map((e=>Array.isArray(e)?2===e.length?`${e[0]} ${e[1].name}`:3===e.length?`[ ${2*e[0]} ${e[1].name} * ${e[2].name} ]/2`:void 0:`${e}`)).join(" + ").replace(/\+ -/g,"- ")}t+=("MAXIMIZE"===e.objective.sense.toUpperCase()?"Maximize":"Minimize")+"\n";const n=0===e.objective.expression[0]?e.objective.expression.slice(1):e.objective.expression;t+=`obj: ${r(n)}\n`,e.constraints.length>0&&(t+="Subject To\n",e.constraints.forEach(((e,n)=>{t+=` c${n+1}: ${r(e.lhs.slice(1))} ${e.comparison} ${e.rhs}\n`})));let i="Bounds\n";e.variables.forEach(((e,t)=>{"BINARY"!==e.vtype&&("-infinity"===e.lb&&"+infinity"===e.ub?i+=` ${t} free\n`:0===e.lb&&"+infinity"===e.ub||(i+=` ${"-infinity"===e.lb?"-inf":e.lb} <= ${t} <= ${"+infinity"===e.ub?"+inf":e.ub}\n`))})),t+=i;let s=[],o=[];for(const[t,r]of e.variables)"INTEGER"===r.vtype?s.push(t):"BINARY"===r.vtype&&o.push(t);let a="";return s.length>0&&(a+="General\n "+s.join(" ")+"\n"),o.length>0&&(a+="Binary\n "+o.join(" ")+"\n"),t+=a,t+="End\n",t}(this)}readLPFormat(e){return function(e,t,r=".lp file"){let n;try{n=s(t,{grammarSource:r})}catch(e){if("function"==typeof e.format)return void console.log(e.format([{source:r,text:t}]));throw e}e.clear(),n.bounds.forEach((t=>{const r={name:t.variable};void 0!==t.lower&&(r.lb=t.lower),void 0!==t.upper&&(r.ub=t.upper),"free"===t.range&&(r.lb="-infinity",r.ub="+infinity"),e.addVar(r)})),n.binary.forEach((t=>{e.variables.has(t)?e.variables.get(t).vtype="BINARY":e.addVar({name:t,vtype:"BINARY"})})),n.general.forEach((t=>{e.variables.has(t)?e.variables.get(t).vtype="INTEGER":e.addVar({name:t,vtype:"INTEGER"})}));const i=new Set;n.objective.expression.forEach((e=>i.add(e.variable))),n.constraints.forEach((e=>e.expression.forEach((e=>i.add(e.variable))))),i.forEach((t=>{e.variables.has(t)||e.addVar({name:t})}));const o=n.objective.expression.map((t=>[t.coefficient,e.variables.get(t.variable)]));return e.setObjective(o,"max"===n.objective.type?"MAXIMIZE":"MINIMIZE"),n.constraints.forEach((t=>{const r=t.expression.map((t=>[t.coefficient,e.variables.get(t.variable)]));e.addConstr(r,t.sense,t.value)})),e}(this,e)}isQuadratic(){function e(e){return e.some((e=>Array.isArray(e)&&3===e.length))}return e(this.objective.expression)||this.constraints.some((t=>e(t.lhs)))}readHighsSolution(e){!function(e,t){e.status=t.Status,"Optimal"!==t.Status&&"Feasible"!==t.Status||(Object.entries(t.Columns).forEach((([t,r])=>{e.variables.has(t)?e.variables.get(t).value=r.Primal:console.warn(`Variable ${t} from the solution was not found in the model.`)})),t.Rows.forEach(((t,r)=>{if(r<e.constraints.length){const n=e.constraints[r];n.primal=t.Primal,n.dual=t.Dual}else console.warn(`Row ${t.Name} from the solution does not correspond to any model constraint.`)})),t.ObjectiveValue&&(e.ObjVal=t.ObjectiveValue))}(this,e)}toGLPKFormat(){if(this.isQuadratic())throw new Error("GLPK.js does not support quadratic models.");return{name:"LP",objective:{direction:"MAXIMIZE"===(e=this).objective.sense.toUpperCase()?t.GLP_MAX:t.GLP_MIN,name:"obj",vars:e.objective.expression.slice(1).map((e=>({name:e[1].name,coef:e[0]})))},subjectTo:e.constraints.map(((e,r)=>({name:`cons${r+1}`,vars:e.lhs.slice(1).map((e=>({name:e[1].name,coef:e[0]}))),bnds:{type:"<="===e.comparison?t.GLP_UP:">="===e.comparison?t.GLP_LO:t.GLP_DB,ub:"<="===e.comparison?e.rhs:0,lb:">="===e.comparison?e.rhs:0}}))),bounds:Array.from(e.variables.values()).map((e=>({name:e.name,type:"-infinity"===e.lb?"+infinity"===e.ub?t.GLP_FR:t.GLP_UP:"+infinity"===e.ub?t.GLP_LO:t.GLP_DB,ub:"+infinity"===e.ub?0:e.ub,lb:"-infinity"===e.lb?0:e.lb}))),binaries:Array.from(e.variables.values()).filter((e=>"BINARY"===e.vtype)).map((e=>e.name)),generals:Array.from(e.variables.values()).filter((e=>"INTEGER"===e.vtype)).map((e=>e.name))};var e}readGLPKSolution(e){!function(e,t){e.status=r[t.result.status],e.ObjVal=t.result.z+e.objective.expression[0],Object.entries(t.result.vars).forEach((([t,r])=>{e.variables.has(t)?e.variables.get(t).value=r:console.warn(`Variable ${t} from the solution was not found in the model.`)})),t.result.dual&&e.constraints.forEach(((e,r)=>{const n=t.result.dual[`cons${r+1}`];void 0!==n&&(e.dual=n)}))}(this,e)}toJSLPSolverFormat(e){if(this.isQuadratic())throw new Error("jsLPSolver does not support quadratic models.");return function(e,t){const r={optimize:"objective",opType:e.objective.sense.toLowerCase().slice(0,3),constraints:{},variables:{},ints:{},binaries:{},unrestricted:{},options:t};return e.variables.forEach(((e,t)=>{r.variables[t]={},("-infinity"===e.lb||e.lb<0)&&(r.unrestricted[t]=1),0!==e.lb&&"-infinity"!==e.lb&&(r.constraints[`${t}_lb`]={min:e.lb}),"+infinity"!==e.ub&&(r.constraints[`${t}_ub`]={max:e.ub}),"BINARY"===e.vtype?r.binaries[t]=1:"INTEGER"===e.vtype&&(r.ints[t]=1)})),e.objective.expression.forEach((e=>{Array.isArray(e)&&(r.variables[e[1].name].objective=e[0])})),e.constraints.forEach(((e,t)=>{const n=`c${t}`;r.constraints[n]={},"<="===e.comparison?r.constraints[n].max=e.rhs:">="===e.comparison?r.constraints[n].min=e.rhs:"="===e.comparison&&(r.constraints[n].equal=e.rhs),e.lhs.forEach((e=>{Array.isArray(e)&&(n in r.variables[e[1].name]||(r.variables[e[1].name][n]=0),r.variables[e[1].name][n]+=e[0])}))})),r}(this,e)}readJSLPSolverSolution(e){!function(e,t){e.status=t.feasible?t.bounded?"Optimal":"Unbounded":"Infeasible",e.variables.forEach(((e,r)=>{e.value=r in t?t[r]:0})),t.result&&(e.ObjVal=t.result+e.objective.expression[0])}(this,e)}async solve(e,t={}){this.solution=null,this.variables.forEach((e=>e.value=null)),this.constraints.forEach((e=>{e.primal=null,e.dual=null})),this.ObjVal=null,Object.hasOwn(e,"branchAndCut")&&Object.hasOwn(e,"lastSolvedModel")?(this.solution=e.Solve(this.toJSLPSolverFormat(t)),this.readJSLPSolverSolution(this.solution)):Object.hasOwn(e,"GLP_OPT")?(this.solution=await e.solve(this.toGLPKFormat(),t),this.readGLPKSolution(this.solution)):Object.hasOwn(e,"_Highs_run")&&(this.solution=e.solve(this.toLPFormat(),t),this.readHighsSolution(this.solution))}},e.Var=o}));
//# sourceMappingURL=lp-model.min.js.map
